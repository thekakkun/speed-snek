class t{constructor(t,e,s){this.element=document.getElementById(t),this.setSize(e,s)}setSize(t,e){this.width=t,this.height=e,this.element.style.width=`${t}px`,this.element.style.height=`${e}px`;const s=window.devicePixelRatio;this.element.width=Math.floor(t*s),this.element.height=Math.floor(e*s),this.context=this.element.getContext("2d"),this.context.scale(s,s)}}class e{setParent(t){this.parent=t}getParent(){return this.parent}}class s extends e{children=[];add(t){this.children.push(t),t.setParent(this)}remove(t){const e=this.children.indexOf(t);this.children.splice(e,1),t.setParent(null)}render(){for(const t of this.children)t.render()}}class i extends e{constructor(t,e){super(),this.data=t,this.target=e}}function h(t,e){return Math.sqrt((t.x-e.x)**2+(t.y-e.y)**2)}function a(t,e){if("center"in e){const[{x:s,y:i},{x:h,y:a}]=t,{center:{x:r,y:n},radius:o}=e,c=(s-h)**2+(i-a)**2,l=(s-h)*(h-r)+(i-a)*(a-n),d=l**2-c*((h-r)**2+(a-n)**2-o**2);if(d<0)return!1;let p;return p=(-l-Math.sqrt(d))/c,0<=p&&p<=1||(p=(-l+Math.sqrt(d))/c),0<=p&&p<=1&&{x:p*s+(1-p)*h,y:p*i+(1-p)*a}}{const[{x:s,y:i},{x:h,y:a}]=t,[{x:r,y:n},{x:o,y:c}]=e,l=((s-r)*(n-c)-(i-n)*(r-o))/((s-h)*(n-c)-(i-a)*(r-o));if(!(0<=l&&l<=1))return!1;const d=((s-r)*(i-a)-(i-n)*(s-h))/((s-h)*(n-c)-(i-a)*(r-o));return 0<=d&&d<=1&&{x:s+l*(h-s),y:i+l*(a-i)}}}function r(t,e){return Math.random()*(e-t)+t}class n{constructor(t){this.mediator=t}setMediator(t){this.mediator=t}}let o,c,l,d,p;const[m,g]=function(t=80){let e,s;const i=document.documentElement.clientHeight,h=document.documentElement.clientWidth;return(i-t)/h<1.5?(s=Math.min(600,i-t),e=1.5*s):(e=Math.min(600,h),s=1.5*e),[e,s]}(80);console.log([m,g]);const u=new t("ui",Math.min(m-200,400),80),x=new t("game",m,g);c=new class extends n{constructor(t){super(),this.target=t,this.path=[],this.timeStamp=[],this.speed=0,this.smoothSpeed=0,this.speedLimit=0,this.speedIncrease=.05,this.maxSpeed=5,this.moveHandler=this.moveHandler.bind(this)}moveHandler(t){const e={x:t.x-this.target.offsetLeft,y:t.y-this.target.offsetTop};this.path.unshift(e),this.timeStamp.unshift(t.timeStamp),this.mediator.notify(["pointermove",this])}trim(t){this.path.splice(t),this.timeStamp.splice(t)}getSpeed(t=6){if((t=Math.min(t,this.path.length-1))<2)return 0;let e=0,s=0;for(let i=0;i<t;i++)e+=h(this.path[i],this.path[i+1]),s+=this.timeStamp[i]-this.timeStamp[i+1];return e/s}updateSpeed(){this.speed=this.getSpeed(),this.speed,this.smoothSpeed=.1*this.speed+.9*this.smoothSpeed,this.smoothSpeed<this.speedLimit&&this.mediator.notify(["tooslow",this])}increaseSpeed(){this.speedLimit=Math.min(this.speedLimit+this.speedIncrease,this.maxSpeed)}checkCollision(t,e){e.loc&&2<=this.path.length&&a([this.path[0],this.path[1]],{center:e.loc,radius:e.r+t.snekWidth/2})&&this.mediator.notify(["eatpellet",this]),(this.path[0].x-1<=0||this.target.clientWidth-1<=this.path[0].x||this.path[0].y-1<=0||this.target.clientHeight-1<=this.path[0].y)&&this.mediator.notify(["hitwall",this]);for(let e=2;e<t.path.length-1;e++)a([t.path[0],t.path[1]],[t.path[e],t.path[e+1]])&&this.mediator.notify(["hitself",this])}}(x.element),l=new class extends n{constructor(t){super(),this.segments=4,this.segLength=50,this.snekWidth=10,this.path=[t];for(let t=0;t<this.segments;t++){const e={x:this.path[t].x,y:this.path[t].y+this.segLength};this.path.push(e)}}update(t){const e=t.path;this.path=[e[0]];let s=this.path[this.path.length-1];for(let[t,i]of e.entries())if(this.path.length<=this.segments)for(;this.segLength<h(s,i);){if(s=a([e[t-1],i],{center:s,radius:this.segLength}),this.path.push(s),this.segments<this.path.length)break}else if(2*this.segLength<=h(s,i)){this.mediator.notify(["trimpath",this,t]);break}}grow(){this.segments+=1}}({x:x.width/2,y:x.height/2}),d=new class extends n{constructor(t,e){super(),this.r=15,this.target=t,this.place(e)}place(t,e=30){let s,i;for(;;){if(i=!0,s={x:r(e,this.target.clientWidth-e),y:r(e,this.target.clientHeight-e)},0===t.length){this.loc=s;break}for(let h=0;h<t.length-1;h++)if(a([t[h],t[h+1]],{center:s,radius:this.r+e})){i=!1;break}if(i){this.loc=s;break}}}}(x.element,l.path),o=new class{constructor(t,e,s){this.score=0;const i=localStorage.getItem("bestScore");this.bestScore=i?Number(i):0,this.cursor=t,this.cursor.setMediator(this),this.snek=e,this.snek.setMediator(this),this.pellet=s,this.pellet.setMediator(this)}notify(t){const[e,s]=t;switch(e){case"pointermove":this.snek.update(s),this.cursor.updateSpeed(),this.cursor.checkCollision(this.snek,this.pellet);break;case"trimpath":const[,,e]=t;this.cursor.trim(e);break;case"eatpellet":console.log("nom!"),this.snek.grow(),this.increaseScore(),this.cursor.increaseSpeed(),this.pellet.place(this.snek.path);break;case"hitself":console.log("ouch!"),this.gameOver(...t);break;case"hitwall":console.log("whoops!"),this.gameOver(...t);break;case"tooslow":console.log("faster!"),this.gameOver(...t);break;default:return s}}increaseScore(){this.score+=1,this.bestScore=Math.max(this.bestScore,this.score)}gameOver(t,e){localStorage.setItem("bestScore",String(this.bestScore)),document.removeEventListener("pointermove",e.moveHandler),alert(`Game Over!\n${{hitself:"You crashed into yourself!",hitwall:"You crashed into a wall!",tooslow:"You were too slow!"}[t]}\nYour score: ${this.score}`),location.reload()}}(c,l,d);const f=new s;f.add(new class extends i{constructor(t,e){super(t,e)}render(){this.target.strokeStyle="green",this.target.lineCap="round",this.target.lineJoin="round",this.target.lineWidth=this.data.snekWidth,this.target.beginPath(),this.target.moveTo(this.data.path[0].x,this.data.path[0].y),this.data.path.forEach((t=>{this.target.lineTo(t.x,t.y)})),this.target.stroke()}}(l,x.context)),f.add(new class extends i{constructor(t,e){super(t,e)}render(){this.data.loc&&(this.target.fillStyle="blue",this.target.beginPath(),this.target.arc(this.data.loc.x,this.data.loc.y,this.data.r,0,2*Math.PI),this.target.fill())}}(d,x.context));const S=new s;S.add(new class extends i{constructor(t,e){super(t,e)}render(){const t=10,e=10,s={x:this.target.canvas.clientWidth-t,y:this.target.canvas.clientHeight-20};this.target.fillStyle="#eee",this.target.fillRect(t,e,s.x,s.y),this.target.fillStyle="orangeRed",this.target.fillRect(t,e,s.x*this.data.speedLimit/this.data.maxSpeed,s.y);const i=Math.min(this.data.smoothSpeed,this.data.maxSpeed);this.target.fillStyle="green",this.target.beginPath(),this.target.moveTo(s.x*i/this.data.maxSpeed-5+t,e+s.y),this.target.lineTo(s.x*i/this.data.maxSpeed+5+t,e+s.y),this.target.lineTo(s.x*i/this.data.maxSpeed+1+t,e+10),this.target.lineTo(s.x*i/this.data.maxSpeed-1+t,e+10),this.target.fill()}}(c,u.context)),S.add(new class extends i{constructor(t,e){super(t,e)}render(){let t=`Score: ${String(this.data.score).padStart(2," ")}`;this.target.innerText=t}}(o,document.getElementById("currentScore"))),S.add(new class extends i{constructor(t,e){super(t,e)}render(){let t=`Best: ${String(this.data.bestScore).padStart(2," ")}`;this.target.innerText=t}}(o,document.getElementById("bestScore"))),p=new s,p.add(f),p.add(S);(new class{constructor(){this.gameLoop=this.gameLoop.bind(this)}init(){window.requestAnimationFrame(this.gameLoop),document.addEventListener("pointermove",c.moveHandler)}gameLoop(){this.render(),this.update(),requestAnimationFrame(this.gameLoop)}update(){}render(){x.context.clearRect(0,0,x.width,x.height),u.context.clearRect(0,0,u.width,u.height),p.render()}}).init();
//# sourceMappingURL=index.43ca43c2.js.map
