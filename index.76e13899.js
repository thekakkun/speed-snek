function e(e,t){return Math.sqrt((e.x-t.x)**2+(e.y-t.y)**2)}function t(e,t){if("center"in t){const[{x:s,y:i},{x:n,y:a}]=e,{center:{x:h,y:r},radius:o}=t,c=(s-n)**2+(i-a)**2,d=(s-n)*(n-h)+(i-a)*(a-r),m=d**2-c*((n-h)**2+(a-r)**2-o**2);if(m<0)return!1;let l;return l=(-d-Math.sqrt(m))/c,0<=l&&l<=1||(l=(-d+Math.sqrt(m))/c),0<=l&&l<=1&&{x:l*s+(1-l)*n,y:l*i+(1-l)*a}}{const[{x:s,y:i},{x:n,y:a}]=e,[{x:h,y:r},{x:o,y:c}]=t,d=((s-h)*(r-c)-(i-r)*(h-o))/((s-n)*(r-c)-(i-a)*(h-o));if(!(0<=d&&d<=1))return!1;const m=((s-h)*(i-a)-(i-r)*(s-n))/((s-n)*(r-c)-(i-a)*(h-o));return 0<=m&&m<=1&&{x:s+d*(n-s),y:i+d*(a-i)}}}function s(e,t){return Math.random()*(t-e)+e}class i extends class{constructor(e){this.canvas=e,this.path=[],this.timeStamp=[],this.rawSpeed=0,this.lastEvent="",this.moveHandler=this.moveHandler.bind(this)}moveHandler(e){if(e instanceof PointerEvent){const t={x:e.x-this.canvas.element.getBoundingClientRect().x,y:e.y-this.canvas.element.getBoundingClientRect().y};this.path.unshift(t),this.timeStamp.unshift(e.timeStamp)}else this.lastEvent===e.type&&this.path.length&&(this.path.unshift(this.path[0]),this.timeStamp.unshift(e.timeStamp));this.lastEvent=e.type}trim(e){this.path.splice(e),this.timeStamp.splice(e)}setSpeed(t=6){(t=Math.min(t,this.path.length-1))<2&&(this.rawSpeed=0);let s=0,i=0;for(let n=0;n<t;n++)s+=e(this.path[n],this.path[n+1]),i+=this.timeStamp[n]-this.timeStamp[n+1];this.rawSpeed=0===s||0===i?0:s/i}}{constructor(e){super(e),this.segments=4,this.segLength=50,this.snekWidth=10,this.speed=0,this.segmentPath=[{x:this.canvas.width/2,y:this.canvas.height/2}];for(let e=0;e<this.segments;e++){const t={x:this.segmentPath[e].x,y:this.segmentPath[e].y+this.segLength};this.segmentPath.push(t)}}moveHandler(e){super.moveHandler(e),this.calculateSegments(),this.setSpeed()}calculateSegments(){Object.assign(this.segmentPath,this.path,{length:1});let s=this.segmentPath[this.segmentPath.length-1];for(let[i,n]of this.path.entries())if(this.segmentPath.length<=this.segments)for(;this.segLength<e(s,n);){if(s=t([this.path[i-1],n],{center:s,radius:this.segLength}),this.segmentPath.push(s),this.segments<this.segmentPath.length)break}else 2*this.segLength<=e(s,n)&&super.trim(i)}setSpeed(e=6){super.setSpeed(e);this.speed=.05*this.rawSpeed+.95*this.speed}grow(){this.segments+=1}}class n{constructor(e){this.radius=15,this.target=e,this.loc=Object.create({})}place(e,i=30){let n,a;for(;;){if(a=!0,n={x:s(i,this.target.clientWidth-i),y:s(i,this.target.clientHeight-i)},0===e.length){this.loc=n;break}for(let s=0;s<e.length-1;s++)if(t([e[s],e[s+1]],{center:n,radius:this.radius+i})){a=!1;break}if(a){Object.assign(this.loc,n);break}}}}function a(){let e,t;const s=parseInt(getComputedStyle(document.getElementById("game")).borderWidth),i=document.documentElement.clientHeight,n=document.documentElement.clientWidth,a=document.getElementById("ui")?.clientHeight;return(i-a)/n<1?(t=Math.min(600,i-a-2*s),e=1.5*t):(e=Math.min(600,n-2*s),t=1.5*e),[e,t]}class h{constructor(e,t,s){this.element=document.getElementById(e),this.context=this.element.getContext("2d"),void 0===t&&(t=this.element.clientWidth),void 0===s&&(s=this.element.clientHeight),this.width=t,this.height=s,this.setSize()}setSize(){this.element.style.width=`${this.width}px`,this.element.style.height=`${this.height}px`,this.element.width=Math.floor(this.width*devicePixelRatio),this.element.height=Math.floor(this.height*devicePixelRatio),this.context.scale(devicePixelRatio,devicePixelRatio)}clear(){this.context.clearRect(0,0,this.width,this.height)}}class r{setParent(e){this.parent=e}getParent(){return this.parent}}class o extends r{children=[];add(e){this.children.push(e),e.setParent(this)}remove(e){const t=this.children.indexOf(e);this.children.splice(t,1),e.setParent(null)}render(){for(const e of this.children)e.render()}}class c extends r{constructor(e,t){super(),this.data=e,this.target=t}}class d extends c{constructor(e,t,s,i){super(e,t),this.color=s,this.width=i}render(){const e=this.data;0!==e.length&&(this.target.strokeStyle=this.color,this.target.lineWidth=this.width,this.target.lineCap="round",this.target.lineJoin="round",this.target.beginPath(),this.target.moveTo(e[0].x,e[0].y),e.forEach((e=>{this.target.lineTo(e.x,e.y)})),this.target.stroke())}}class m extends c{constructor(e,t,s,i){super(e,t),this.color=s,this.width=i}render(){this.target.beginPath(),this.target.strokeStyle=this.color,this.target.lineWidth=this.width,this.target.arc(this.data.center.x,this.data.center.y,this.data.radius,0,2*Math.PI),this.target.stroke()}}class l extends c{constructor(e,t,s){super(e,t),this.color=s}render(){this.data.center&&(this.target.fillStyle=this.color,this.target.beginPath(),this.target.arc(this.data.center.x,this.data.center.y,this.data.radius,0,2*Math.PI),this.target.fill())}}class g extends c{constructor(e,t,s){super(e,t),this.color=s}render(){const e=this.data[0],t={x:this.data[1].x-e.x,y:this.data[1].y-e.y};this.target.fillStyle=this.color,this.target.fillRect(e.x,e.y,t.x,t.y)}}class p extends c{constructor(e,t){super(e,t),this.composite=new o}render(){const e=this.data.speedCanvas,t=new g([{x:0,y:0},{x:e.width,y:e.height}],e.context,"#eee"),s=new g([{x:0,y:0},{x:e.width*this.data.speedLimit/this.data.maxSpeed,y:e.height}],e.context,"orangered"),i=new u(this.data,e.context);return this.composite.add(t),this.composite.add(s),this.composite.add(i),this.composite.render()}}class u extends c{constructor(e,t){super(e,t)}render(){const e=this.data.speedCanvas,t=Math.min(this.data.snek.speed,this.data.maxSpeed),s=e.width*t/this.data.maxSpeed;this.target.fillStyle="green",this.target.beginPath(),this.target.moveTo(s-5,this.data.speedCanvas.height),this.target.lineTo(s+5,this.data.speedCanvas.height),this.target.lineTo(s+1,10),this.target.lineTo(s-1,10),this.target.fill()}}class y{constructor(){this.score=0;const e=localStorage.getItem("bestScore");this.bestScore=e?Number(e):0,this.speedLimit=0,this.speedIncrement=.05,this.maxSpeed=5,this.showScore(),this.gameCanvas=new h("gameBoard",...a());document.getElementById("ui").style.width=`${this.gameCanvas.width}px`,this.speedCanvas=new h("speedometer"),this.deviceType="pc",this.snek=new i(this.gameCanvas),this.pellet=new n(this.gameCanvas.element),this.transitionTo(new v)}transitionTo(e){this.state&&this.state.exit(),this.state=e,this.state.setContext(this),this.state.enter()}increaseScore(){this.score+=1,this.bestScore=Math.max(this.bestScore,this.score),this.speedLimit=Math.min(this.speedLimit+this.speedIncrement,this.maxSpeed),this.snek.grow()}gameLoop(){this.update(),this.render(),this.reqId=requestAnimationFrame((()=>this.gameLoop()))}showScore(){document.getElementById("currentScore").innerHTML=`Score: ${String(this.score).padStart(2," ")}`;document.getElementById("bestScore").innerHTML=`Best: ${String(this.bestScore).padStart(2," ")}`}update(){this.showScore(),this.state.update()}render(){this.gameCanvas.clear(),this.speedCanvas.clear(),this.state.graphics.render(),dispatchEvent(new Event("render"))}}class x{constructor(e=new o){this.graphics=e,this.messageElement=document.getElementById("message")}setContext(e){this.game=e}update(){}}class v extends x{constructor(){super()}enter(){document.getElementById("info").style.display="flex";document.getElementById("startMessage").style.display="block";document.getElementById("endMessage").style.display="none";const e=document.getElementById("startButton");e.addEventListener("click",(e=>{console.log(e),this.game.transitionTo(new w)}),{once:!0}),e.addEventListener("pointerup",(e=>{"touch"===e.pointerType&&(this.game.deviceType="mobile")}),{once:!0})}exit(){document.getElementById("info").style.display="none"}}class w extends x{constructor(){super(),this.checkPlayerReady=this.checkPlayerReady.bind(this)}enter(){const e="pc"===this.game.deviceType?"cursor":"finger";this.messageElement.innerText=`${e} on the circle to start`,this.initUiGraphics(),this.initGameGraphics(),this.game.gameCanvas.element.addEventListener("pointermove",this.checkPlayerReady),this.game.gameLoop()}initUiGraphics(){const e=this.game.speedCanvas.context,t=new p(this.game,e);this.graphics.add(t)}initGameGraphics(){const e=this.game.gameCanvas,t=this.game.gameCanvas.context,s=this.game.snek,i=new o,n=new d(s.segmentPath,t,"green",s.snekWidth);i.add(n),this.graphics.add(i),this.readyArea={center:{x:e.width/2,y:e.height/2},radius:30},this.readyAreaGraphics=new m(this.readyArea,t,"blue",5),this.graphics.add(this.readyAreaGraphics)}checkPlayerReady(t){const s=this.game.gameCanvas.element.parentElement;e({x:t.x-s.offsetLeft-s.clientLeft,y:t.y-s.offsetTop-s.clientTop},this.readyArea.center)<this.readyArea.radius&&this.game.transitionTo(new k(this.graphics))}exit(){this.game.gameCanvas.element.removeEventListener("pointermove",this.checkPlayerReady),this.graphics.remove(this.readyAreaGraphics)}}class k extends x{constructor(e){super(e),this.startTime=Date.now(),this.readyCheck=this.readyCheck.bind(this)}enter(){const e=this.game.snek,t=this.game.gameCanvas.element;t.addEventListener("pointermove",e.moveHandler),addEventListener("render",e.moveHandler),t.addEventListener("pointerout",this.readyCheck,{once:!0}),t.addEventListener("touchend",this.readyCheck,{once:!0})}update(){const e=(Date.now()-this.startTime)/1e3;this.messageElement.innerText=String(3-Math.floor(e)),3<e&&this.game.transitionTo(new S(this.graphics))}readyCheck(){this.game.gameCanvas.element.removeEventListener("pointermove",this.game.snek.moveHandler),removeEventListener("render",this.game.snek.moveHandler),this.game.transitionTo(new w)}exit(){this.game.gameCanvas.element.removeEventListener("touchend",this.readyCheck)}}class S extends x{constructor(e){super(e)}enter(){this.game.gameCanvas.element.addEventListener("pointerout",(()=>{console.log("whoops!"),this.game.transitionTo(new f("You crashed into a wall!"))}),{once:!0}),this.messageElement.innerHTML="GO!",setTimeout((()=>{this.messageElement.innerText=""}),1e3);const e=this.game.pellet,t=this.game.snek;e.place(t.segmentPath);const s=this.game.gameCanvas.context;this.graphics.add(new l({center:this.game.pellet.loc,radius:this.game.pellet.radius},s,"blue"))}update(){this.speedCheck(),this.snekPelletCollision(),this.snekSnekCollision()}speedCheck(){this.game.snek.speed<this.game.speedLimit&&(console.log("faster!"),this.game.transitionTo(new f("You were too slow!")))}snekPelletCollision(){this.game.pellet.loc&&2<=this.game.snek.segmentPath.length&&t([this.game.snek.segmentPath[0],this.game.snek.segmentPath[1]],{center:this.game.pellet.loc,radius:this.game.pellet.radius+this.game.snek.snekWidth/2})&&(console.log("nom!"),this.game.increaseScore(),this.game.pellet.place(this.game.snek.segmentPath))}snekWallCollision(){const e=this.game.gameCanvas.element;(this.game.snek.segmentPath[0].x-1<=0||e.clientWidth-1<=this.game.snek.segmentPath[0].x||this.game.snek.segmentPath[0].y-1<=0||e.clientHeight-1<=this.game.snek.segmentPath[0].y)&&(console.log("whoops!"),this.game.transitionTo(new f("You crashed into a wall!")))}snekSnekCollision(){for(let e=2;e<this.game.snek.segmentPath.length-1;e++)t([this.game.snek.segmentPath[0],this.game.snek.segmentPath[1]],[this.game.snek.segmentPath[e],this.game.snek.segmentPath[e+1]])&&(console.log("ouch!"),this.game.transitionTo(new f("You crashed into yourself!")))}exit(){this.game.gameCanvas.element.removeEventListener("pointermove",this.game.snek.moveHandler),removeEventListener("render",this.game.snek.moveHandler),cancelAnimationFrame(this.game.reqId)}}class f extends x{constructor(e){super(),this.reason=e}enter(){localStorage.setItem("bestScore",String(this.game.bestScore));document.getElementById("reason").innerText=this.reason;document.getElementById("score").innerText=`Score: ${this.game.score}`;document.getElementById("best").innerText=`Best: ${this.game.bestScore}`+(this.game.score===this.game.bestScore?" (NEW BEST!)":"");document.getElementById("info").style.display="flex";document.getElementById("startMessage").style.display="none";document.getElementById("endMessage").style.display="block";document.getElementById("restartButton").addEventListener("click",(()=>this.game.transitionTo(new v)),{once:!0})}exit(){location.reload()}}window.addEventListener("load",(()=>{new y}));
//# sourceMappingURL=index.76e13899.js.map
